package stellar.sdk.model.ledger

import org.specs2.concurrent.ExecutionEnv
import org.specs2.mutable.Specification
import stellar.sdk.PublicNetwork
import stellar.sdk.model.{Desc, Now}

import scala.concurrent.Await
import scala.concurrent.duration._

class TransactionLedgerEntriesSpec(ee: ExecutionEnv) extends Specification {

  import ee.ec

  "transaction meta parsing" should {
    "work" >> {
      val decoded = TransactionLedgerEntries.decodeXDR(
        """
          |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
          |AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA==
        """.stripMargin.split("""\n""").mkString)

/*
      decoded must beEqualTo(
        TransactionLedgerEntries(
          txnLevelChanges = None,
          operationLevelChanges = List(
            LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),999999999999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999999999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GAIH3ULLFQ4DGSECF2AR555KZ4KNDGEKN4AFI4SU2M7B43MGK3QJZNSR"),100000000000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999999999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999899999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GDO34SQXVOSNODK7JCTAXLZUPSAF3JIH4ADQELVIKOQJUWQ3U4BMSCSH"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999899999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999799999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999799999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999699999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999699999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999599999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),100000000000,661424963584,1,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(TrustLineEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,0,9223372036854775807,true,None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),100000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),100000000000,661424963584,1,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(TrustLineEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,0,9223372036854775807,true,None)))), LedgerEntryChanges(LedgerEntryState(TrustLineEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,0,9223372036854775807,true,None)),NonEmptyList(LedgerEntryUpdate(TrustLineEntry(PublicKey("GAAJKG3WQKHWZJ5RGVVZMVV6X3XYU7QUH2YVATQ2KBVR2ZJYLG35Z65A"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,10000000000000,9223372036854775807,true,None)))), LedgerEntryChanges(LedgerEntryState(TrustLineEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,0,9223372036854775807,true,None)),NonEmptyList(LedgerEntryUpdate(TrustLineEntry(PublicKey("GCNP7JE6KR5CKHMVVFTZJUSP7ALAXWP62SK6IMIY4IF3JCHEZKBJKDZF"),GDNFUWF2EO4OWXYLI4TDEH4DXUCN6PB24R6XQW4VATORK6WGMHGRXJVB:TEST,10000000000000,9223372036854775807,true,None)))), LedgerEntryChanges(LedgerEntryState(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),899999599999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)),NonEmptyList(LedgerEntryUpdate(AccountEntry(PublicKey("GBRPYHIL2CI3FNQ4BXLFMNDLFJUNPU2HY3ZMFSHONUCEOASW7QC7OX2H"),999999000,1,0,None,Set(),None,Thresholds(1,0,0),List(),None)), LedgerEntryCreate(AccountEntry(PublicKey("GBFAIH5WKAJQ77NG6BZG7TGVGXHPX4SQLIJ7BENJMCVCZSUZPSISCLU5"),899999599000000000,661424963584,0,None,Set(),None,Thresholds(1,0,0),List(),None))))))
      )
*/

      ok
    }

    "parse 100" >> {
      Await.result(PublicNetwork.transactions(cursor = Now, order = Desc), 1.minute).take(1000)
        .foreach { t =>
          println(t.resultMetaXDR)
          println(t.ledgerEntries)
        }
      ok
    }

  }


}
